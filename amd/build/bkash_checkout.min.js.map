{"version":3,"sources":["../src/bkash_checkout.js"],"names":["define","$","Ajax","setup","bkash_information","paymentID","username","config","console","log","password","app_key","appkey","app_secret","appsecretkey","amount","currency","courseid","userid","instanceid","item_name","document","ready","getAuthToken","ajax","url","headers","type","data","JSON","stringify","success","result","id_token","initBkash","error","request","bKash","init","paymentMode","paymentRequest","createRequest","contentType","create","onSuccess","onError","alert","errorMessage","executeRequestOnAuthorization","params","transactionStatus","trxID","call","methodname","args","done","fail","Notification","exception","myobject","window","location","href","execute","onClose"],"mappings":"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","sourcesContent":["define(['jquery',  'core/ajax'], function ($, Ajax)\r\n{\r\n\r\n    return {\r\n        setup: function(bkash_information) {\r\n\r\n\r\n    var paymentID;\r\n\r\n    var username = bkash_information.config.username;\r\n        console.log(username);\r\n\r\n    var password = bkash_information.config.password;\r\n        console.log(password);\r\n\r\n    var app_key = bkash_information.config.appkey;\r\n        console.log(app_key);\r\n\r\n    var app_secret = bkash_information.config.appsecretkey;\r\n        console.log(app_secret);\r\n\r\n    var amount = bkash_information.amount;\r\n    var currency = bkash_information.currency;\r\n    var courseid = bkash_information.courseid;\r\n    var userid = bkash_information.userid;\r\n    var instanceid = bkash_information.instanceid;\r\n    var item_name = bkash_information.item_name;\r\n\r\n        console.log(currency);\r\n        console.log(amount);\r\n        console.log(courseid);\r\n        console.log(userid);\r\n        console.log(instanceid);\r\n        console.log(item_name);\r\n\r\n\r\n    var grantTokenUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/token/grant';\r\n    var createCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/create';\r\n    var executeCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/execute';\r\n\r\n    $(document).ready(function () {\r\n        getAuthToken();\r\n    });\r\n\r\n    function getAuthToken() {\r\n        let body = {\r\n            \"app_key\": app_key,\r\n            \"app_secret\": app_secret\r\n        };\r\n\r\n        $.ajax({\r\n            url: grantTokenUrl,   // Sandbox checkout\r\n            headers: {\r\n                \"username\": username,\r\n                \"password\": password,\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            type: 'POST',\r\n            data: JSON.stringify(body),   //JS obj to string covert\r\n            success: function (result) {\r\n\r\n                let headers = {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"Authorization\": result.id_token, // Contains access token\r\n                    \"X-APP-Key\": app_key\r\n                };\r\n\r\n                let request = {             //create payment API\r\n                    \"amount\": amount,\r\n                    \"intent\": \"sale\",\r\n                    \"currency\": currency,\r\n                    \"merchantInvoiceNumber\": \"123456\"\r\n                };\r\n\r\n\r\n                initBkash(headers, request);\r\n            },\r\n            error: function (error) {\r\n                console.log(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    function initBkash(headers, request) {\r\n        bKash.init({\r\n            paymentMode: 'checkout',\r\n            paymentRequest: request,\r\n\r\n            createRequest: function (request) {\r\n                $.ajax({\r\n                    url: createCheckoutUrl,\r\n                    headers: headers,\r\n                    type: 'POST',\r\n                    contentType: 'application/json',\r\n                    data: JSON.stringify(request),\r\n                    success: function (data) {\r\n\r\n                        if (data && data.paymentID != null) {\r\n                            paymentID = data.paymentID;\r\n                            bKash.create().onSuccess(data);\r\n                            // console.log(data);\r\n\r\n\r\n                        }\r\n                        else {\r\n                            bKash.create().onError(); // Run clean up code\r\n                            alert(data.errorMessage + \" Tag should be 2 digit, Length should be 2 digit, Value should be number of character mention in Length, ex. MI041234 , supported tags are MI, MW, RF\");\r\n                        }\r\n\r\n                    },\r\n                    error: function () {\r\n                        bKash.create().onError(); // Run clean up code\r\n                        alert(data.errorMessage);\r\n                    }\r\n                });\r\n            },\r\n            executeRequestOnAuthorization: function () {\r\n                $.ajax({\r\n                    url: executeCheckoutUrl + '/' + paymentID,\r\n                    headers: headers,\r\n                    type: 'POST',\r\n                    contentType: 'application/json',\r\n                    success: function (data) {\r\n\r\n                        if (data && data.paymentID != null) {\r\n                            // On success, perform your desired action\r\n                            // console.log(data.paymentID);\r\n                            // console.log(data.amount);\r\n                            // console.log(data.currency);\r\n\r\n\r\n                            var wsfunction = 'enrol_bkash_bkash_enrolment_detail';\r\n                            var params = {\r\n                                'courseid' : courseid,\r\n                                'userid' : userid,\r\n                                'payment_status' : data.transactionStatus,\r\n                                'txn_id' : data.trxID,\r\n                                'item_name' : item_name,\r\n                                'instanceid' : instanceid\r\n\r\n                            };\r\n\r\n                            var request={\r\n                                methodname: wsfunction,\r\n                                args: params\r\n                            };\r\n\r\n\r\n                            Ajax.call([request])[0].done(function(data) {\r\n\r\n                            console.log(data);\r\n                            }).fail(Notification.exception);\r\n\r\n                            // console.log(params);\r\n\r\n\r\n                            myobject = JSON.stringify(data);\r\n\r\n\r\n                            alert('[SUCCESS] data : ' + myobject);\r\n\r\n                            window.location.href = \"/success_page.html\";\r\n\r\n\r\n                            // window.location.href = $(location).attr('href');\r\n\r\n                        } else {\r\n                            alert('[ERROR] data : ' + JSON.stringify(data));\r\n                            bKash.execute().onError();//run clean up code\r\n                        }\r\n\r\n                    },\r\n                    error: function () {\r\n                        alert('An alert has occurred during execute');\r\n                        bKash.execute().onError(); // Run clean up code\r\n                    }\r\n                });\r\n            },\r\n            onClose: function () {\r\n                alert('User has clicked the close button');\r\n            }\r\n        });\r\n\r\n    }\r\n}\r\n\r\n}});\r\n"],"file":"bkash_checkout.min.js"}