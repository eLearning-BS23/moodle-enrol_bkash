{"version":3,"sources":["../src/bkash_checkout.js"],"names":["define","$","Ajax","setup","bkash_information","paymentID","username","config","password","app_key","appkey","app_secret","appsecretkey","amount","currency","courseid","userid","instanceid","item_name","document","ready","getAuthToken","ajax","url","headers","type","data","JSON","stringify","success","result","id_token","initBkash","error","console","log","request","bKash","init","paymentMode","paymentRequest","createRequest","contentType","create","onSuccess","onError","alert","errorMessage","executeRequestOnAuthorization","window","location","href","execute","onClose"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax) {\n\n    return {\n        setup: function(bkash_information) {\n\n\n            var paymentID;\n\n            var username = bkash_information.config.username;\n\n            var password = bkash_information.config.password;\n\n            var app_key = bkash_information.config.appkey;\n\n\n            var app_secret = bkash_information.config.appsecretkey;\n\n            var amount = bkash_information.amount;\n            var currency = bkash_information.currency;\n            var courseid = bkash_information.courseid;\n            var userid = bkash_information.userid;\n            var instanceid = bkash_information.instanceid;\n            var item_name = bkash_information.item_name;\n\n            var grantTokenUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/token/grant';\n            var createCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/create';\n            var executeCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/execute';\n\n\n            $(document).ready(function() {\n                getAuthToken();\n            });\n\n            function getAuthToken() {\n                let body = {\n                    \"app_key\": app_key,\n                    \"app_secret\": app_secret\n                };\n\n                $.ajax({\n                    url: grantTokenUrl,   // Sandbox checkout\n                    headers: {\n                        \"username\": username,\n                        \"password\": password,\n                        \"Content-Type\": \"application/json\"\n                    },\n                    type: 'POST',\n                    data: JSON.stringify(body),   //JS obj to string covert\n                    success: function(result) {\n\n                        let headers = {\n                            \"Content-Type\": \"application/json\",\n                            \"Authorization\": result.id_token, // Contains access token\n                            \"X-APP-Key\": app_key\n                        };\n\n                        let request = {             //create payment API\n                            \"amount\": amount,\n                            \"intent\": \"sale\",\n                            \"currency\": \"BDT\",\n                            \"merchantInvoiceNumber\": \"123456\"\n                        };\n\n                        initBkash(headers, request);\n                    },\n                    error: function(error) {\n                        console.log(error);\n                    }\n                });\n            }\n\n            function initBkash(headers, request) {\n                bKash.init({\n                    paymentMode: 'checkout',\n                    paymentRequest: request,\n\n                    createRequest: function(request) {\n                        $.ajax({\n                            url: createCheckoutUrl,\n                            headers: headers,\n                            type: 'POST',\n                            contentType: 'application/json',\n                            data: JSON.stringify(request),\n                            success: function(data) {\n\n                                if (data && data.paymentID != null) {\n                                    paymentID = data.paymentID;\n                                    bKash.create().onSuccess(data);\n                                }\n                                else {\n                                    bKash.create().onError(); // Run clean up code\n                                    alert(data.errorMessage + \" Tag should be 2 digit, Length should be 2 digit, Value should be number of character mention in Length, ex. MI041234 , supported tags are MI, MW, RF\");\n                                }\n\n                            },\n                            error: function() {\n                                bKash.create().onError(); // Run clean up code\n                                alert(data.errorMessage);\n                            }\n                        });\n                    },\n                    executeRequestOnAuthorization: function() {\n                        $.ajax({\n                            url: executeCheckoutUrl + '/' + paymentID,\n                            headers: headers,\n                            type: 'POST',\n                            contentType: 'application/json',\n                            success: function(data) {\n\n                                if (data && data.paymentID != null) {\n                                    // On success, perform your desired action\n                                    alert('[SUCCESS] data : ' + JSON.stringify(data));\n                                    window.location.href = \"/success_page.html\";\n\n                                } else {\n                                    alert('[ERROR] data : ' + JSON.stringify(data));\n                                    bKash.execute().onError();//run clean up code\n                                }\n\n                            },\n                            error: function() {\n                                alert('An alert has occurred during execute');\n                                bKash.execute().onError(); // Run clean up code\n                            }\n                        });\n                    },\n                    onClose: function() {\n                        alert('User has clicked the close button');\n                    }\n                });\n\n                function store_enroll_data(params) {\n                    var params = {\n                        'courseid': courseid,\n                        'userid': userid,\n                        'payment_status': data.transactionStatus,\n                        'txn_id': data.trxID,\n                        'item_name': item_name,\n                        'instanceid': instanceid\n\n                    };\n                    var wsfunction = 'enrol_bkash_bkash_enrolment_detail';\n                    var params = params;\n\n                    var request = {\n                        methodname: wsfunction,\n                        args: params\n                    };\n\n\n                    Ajax.call([request])[0].done(function(data) {\n\n                        console.log(data);\n                    }).fail(Notification.exception);\n                }\n            }\n\n        }\n    }\n});\n"],"file":"bkash_checkout.min.js"}