{"version":3,"sources":["../src/bkash_checkout.js"],"names":["define","$","Ajax","setup","bkash_information","paymentID","username","config","password","app_key","appkey","app_secret","appsecretkey","amount","currency","courseid","userid","instanceid","item_name","document","ready","getAuthToken","ajax","url","headers","type","data","JSON","stringify","success","result","id_token","initBkash","error","console","log","request","bKash","init","paymentMode","paymentRequest","createRequest","contentType","create","onSuccess","onError","alert","errorMessage","executeRequestOnAuthorization","window","location","href","execute","onClose"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax) {\r\n\r\n    return {\r\n        setup: function(bkash_information) {\r\n\r\n\r\n            var paymentID;\r\n\r\n            var username = bkash_information.config.username;\r\n\r\n            var password = bkash_information.config.password;\r\n\r\n            var app_key = bkash_information.config.appkey;\r\n\r\n\r\n            var app_secret = bkash_information.config.appsecretkey;\r\n\r\n            var amount = bkash_information.amount;\r\n            var currency = bkash_information.currency;\r\n            var courseid = bkash_information.courseid;\r\n            var userid = bkash_information.userid;\r\n            var instanceid = bkash_information.instanceid;\r\n            var item_name = bkash_information.item_name;\r\n\r\n            var grantTokenUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/token/grant';\r\n            var createCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/create';\r\n            var executeCheckoutUrl = 'https://checkout.sandbox.bka.sh/v1.2.0-beta/checkout/payment/execute';\r\n\r\n\r\n            $(document).ready(function() {\r\n                getAuthToken();\r\n            });\r\n\r\n            function getAuthToken() {\r\n                let body = {\r\n                    \"app_key\": app_key,\r\n                    \"app_secret\": app_secret\r\n                };\r\n\r\n                $.ajax({\r\n                    url: grantTokenUrl,   // Sandbox checkout\r\n                    headers: {\r\n                        \"username\": username,\r\n                        \"password\": password,\r\n                        \"Content-Type\": \"application/json\"\r\n                    },\r\n                    type: 'POST',\r\n                    data: JSON.stringify(body),   //JS obj to string covert\r\n                    success: function(result) {\r\n\r\n                        let headers = {\r\n                            \"Content-Type\": \"application/json\",\r\n                            \"Authorization\": result.id_token, // Contains access token\r\n                            \"X-APP-Key\": app_key\r\n                        };\r\n\r\n                        let request = {             //create payment API\r\n                            \"amount\": amount,\r\n                            \"intent\": \"sale\",\r\n                            \"currency\": \"BDT\",\r\n                            \"merchantInvoiceNumber\": \"123456\"\r\n                        };\r\n\r\n                        initBkash(headers, request);\r\n                    },\r\n                    error: function(error) {\r\n                        console.log(error);\r\n                    }\r\n                });\r\n            }\r\n\r\n            function initBkash(headers, request) {\r\n                bKash.init({\r\n                    paymentMode: 'checkout',\r\n                    paymentRequest: request,\r\n\r\n                    createRequest: function(request) {\r\n                        $.ajax({\r\n                            url: createCheckoutUrl,\r\n                            headers: headers,\r\n                            type: 'POST',\r\n                            contentType: 'application/json',\r\n                            data: JSON.stringify(request),\r\n                            success: function(data) {\r\n\r\n                                if (data && data.paymentID != null) {\r\n                                    paymentID = data.paymentID;\r\n                                    bKash.create().onSuccess(data);\r\n                                }\r\n                                else {\r\n                                    bKash.create().onError(); // Run clean up code\r\n                                    alert(data.errorMessage + \" Tag should be 2 digit, Length should be 2 digit, Value should be number of character mention in Length, ex. MI041234 , supported tags are MI, MW, RF\");\r\n                                }\r\n\r\n                            },\r\n                            error: function() {\r\n                                bKash.create().onError(); // Run clean up code\r\n                                alert(data.errorMessage);\r\n                            }\r\n                        });\r\n                    },\r\n                    executeRequestOnAuthorization: function() {\r\n                        $.ajax({\r\n                            url: executeCheckoutUrl + '/' + paymentID,\r\n                            headers: headers,\r\n                            type: 'POST',\r\n                            contentType: 'application/json',\r\n                            success: function(data) {\r\n\r\n                                if (data && data.paymentID != null) {\r\n                                    // On success, perform your desired action\r\n                                    alert('[SUCCESS] data : ' + JSON.stringify(data));\r\n                                    window.location.href = \"/success_page.html\";\r\n\r\n                                } else {\r\n                                    alert('[ERROR] data : ' + JSON.stringify(data));\r\n                                    bKash.execute().onError();//run clean up code\r\n                                }\r\n\r\n                            },\r\n                            error: function() {\r\n                                alert('An alert has occurred during execute');\r\n                                bKash.execute().onError(); // Run clean up code\r\n                            }\r\n                        });\r\n                    },\r\n                    onClose: function() {\r\n                        alert('User has clicked the close button');\r\n                    }\r\n                });\r\n\r\n                function store_enroll_data(params) {\r\n                    var params = {\r\n                        'courseid': courseid,\r\n                        'userid': userid,\r\n                        'payment_status': data.transactionStatus,\r\n                        'txn_id': data.trxID,\r\n                        'item_name': item_name,\r\n                        'instanceid': instanceid\r\n\r\n                    };\r\n                    var wsfunction = 'enrol_bkash_bkash_enrolment_detail';\r\n                    var params = params;\r\n\r\n                    var request = {\r\n                        methodname: wsfunction,\r\n                        args: params\r\n                    };\r\n\r\n\r\n                    Ajax.call([request])[0].done(function(data) {\r\n\r\n                        console.log(data.message);\r\n\r\n\r\n                        str.get_string('txn_repeat', 'enrol_bkash').then(function(langString) {\r\n                            notification.addNotification({\r\n                                message: langString,\r\n                                type: 'error'\r\n                            });\r\n                            console.log(data.message);\r\n\r\n\r\n                        }).catch(Notification.exception);\r\n                        console.log(Notification.exception);\r\n\r\n                    }).fail(Notification.exception);\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n});\r\n"],"file":"bkash_checkout.min.js"}